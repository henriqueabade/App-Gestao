<div id="substituirPecaOverlay" class="fixed inset-0 z-[12000] flex items-center justify-center px-4 py-6 bg-black/60 hidden" aria-hidden="true" data-modal-loading="true">
  <div data-role="modal" role="dialog" aria-modal="true" tabindex="0" class="w-full max-w-4xl max-h-[90vh] bg-surface/80 backdrop-blur-xl border border-white/20 ring-1 ring-white/10 rounded-2xl shadow-2xl/60 flex flex-col overflow-hidden animate-modalFade">
    <header class="flex items-center justify-between px-6 py-4 border-b border-white/10">
      <div>
        <h3 class="text-xl font-bold text-white">Substituir Peça</h3>
        <p data-field="modal-subtitle" class="text-gray-300 text-sm"></p>
      </div>
      <button type="button" data-action="close" class="btn-neutral px-3 py-2 rounded-lg text-white">X</button>
    </header>
    <div class="flex-1 overflow-y-auto modal-scroll">
      <div class="p-6 space-y-6">
        <div class="bg-surface/40 rounded-lg border border-white/10 p-4 space-y-4">
          <div class="space-y-4">
            <h4 class="font-medium text-white">Peça Atual</h4>
            <div class="flex flex-col lg:flex-row lg:items-start lg:justify-between gap-6">
              <div class="flex-1 space-y-3">
                <div>
                  <p class="text-gray-400 text-xs uppercase tracking-wide mb-1">Nome</p>
                  <p class="text-white font-semibold text-lg leading-tight whitespace-pre-line break-words" data-field="piece-name"></p>
                </div>
                <p class="text-sm text-gray-300" data-field="piece-details"></p>
              </div>
              <div class="w-full lg:max-w-md space-y-3">
                <div class="grid grid-cols-2 sm:grid-cols-3 gap-4">
                  <div>
                    <p class="text-gray-400 text-xs uppercase tracking-wide mb-1">Qtd Orçada</p>
                    <p class="text-white font-semibold" data-field="piece-qty"></p>
                  </div>
                  <div>
                    <p class="text-gray-400 text-xs uppercase tracking-wide mb-1">Total em Estoque</p>
                    <p class="text-white font-semibold" data-field="piece-stock-total"></p>
                  </div>
                  <div>
                    <p class="text-gray-400 text-xs uppercase tracking-wide mb-1">Peças Prontas</p>
                    <p class="text-white font-semibold" data-field="piece-ready"></p>
                  </div>
                  <div>
                    <p class="text-gray-400 text-xs uppercase tracking-wide mb-1">Produzir Parcial</p>
                    <p class="text-white font-semibold" data-field="piece-produce-partial"></p>
                  </div>
                  <div>
                    <p class="text-gray-400 text-xs uppercase tracking-wide mb-1">Produzir Total</p>
                    <p class="text-white font-semibold" data-field="piece-produce-total"></p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="space-y-3">
            <div>
              <p class="text-gray-300 text-xs uppercase tracking-wide mb-2">TIPOS SELECIONADOS AUTOMATICAMENTE</p>
              <div data-field="piece-stock-breakdown" class="space-y-3"></div>
            </div>
            <div data-field="piece-selection" class="hidden border border-primary/40 bg-primary/5 rounded-lg p-3 space-y-3"></div>
          </div>
        </div>
        <div class="bg-surface/40 rounded-lg border border-white/10 p-4">
          <h4 class="font-medium text-white mb-3">Buscar alternativa</h4>
          <input type="text" data-role="search" placeholder="Buscar por processo, insumo ou código" class="w-full bg-input border border-inputBorder rounded-lg px-4 py-2 text-white placeholder-gray-400 focus:border-primary focus:ring-2 focus:ring-primary/50 transition" />
        </div>
        <div class="bg-surface/40 rounded-lg border border-white/10 p-4">
          <h4 class="font-medium text-white mb-4">Peças disponíveis</h4>
          <div class="flex flex-wrap items-center justify-between gap-3 text-sm text-gray-300 mb-4" data-field="selection-status">
            <span data-field="selection-counter">Selecionado: 0 / 0</span>
            <span data-field="selection-remaining">Restante: 0</span>
          </div>
          <div data-role="results" class="space-y-3 max-h-[360px] overflow-y-auto pr-1 modal-scroll"></div>
        </div>
      </div>
    </div>
    <footer class="flex justify-end items-center gap-3 px-6 py-4 border-t border-white/10">
      <button type="button" data-action="close" class="btn-danger px-5 py-2 rounded-lg text-white font-medium">Cancelar</button>
      <button type="button" data-action="commit" class="btn-secondary px-5 py-2 rounded-lg text-white font-medium hidden">Adicionar Tipo</button>
      <button type="button" data-action="confirm" class="btn-primary px-5 py-2 rounded-lg text-white font-medium" disabled>Confirmar Substituição</button>
    </footer>
  </div>
</div>
